---
- stat: path=/root/config
  register: config

- git: repo=http://{{ fqdn }}/r/config dest=/root/config force=yes
  when: config.stat.isdir is not defined

- name: Get local config sha1
  command: git ls-remote -h file:///root/config
  register: localsha

- name: Update config repository
  when: localsha.stdout != hostvars["localhost"].configsha.stdout
  command: chdir=/root/config {{ item }}
  with_items:
    - git fetch --all
    - git reset --hard origin/master --
    - git clean -f -x -d
