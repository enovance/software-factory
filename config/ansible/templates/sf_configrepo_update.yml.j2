---
# This playbook reconfigure service based on config repo.
- hosts: localhost
  tasks:
    - name: Get config sha1
      command: git ls-remote -h http://{{ fqdn }}/r/config.git
      register: configsha
- hosts: jenkins:zuul:nodepool:managesf
  tasks:
    - include: tasks/update_configrepo.yaml
- hosts: jenkins
  tasks:
    - include: tasks/jenkins_update.yaml
- hosts: zuul
  tasks:
    - include: tasks/zuul_update.yaml
{% if 'gerritbot' in roles %}
- hosts: gerritbot
  tasks:
    - include: tasks/gerritbot_update.yaml
{% endif %}
- hosts: nodepool
  tasks:
    - include: tasks/nodepool_update.yaml
- hosts: gerrit
  gather_facts: no
  tasks:
    - include: tasks/gerrit_replication_update.yaml
- hosts: managesf
  tasks:
    - include: tasks/update_configrepo.yaml
