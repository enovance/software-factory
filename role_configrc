#!/bin/sh
#

VER=2.0.0

# Version string
SF_PREVIOUS_VER=C7.0-2.0.0beta
SF_VER=${SF_VER:-C7.0-${VER}}

# Set this variable to 1 if we tag and set it back to 0 the commit after the tag
TAGGED_RELEASE=0
# Pinned versions of the subprojects to go with the current release
PYSFLIB_PINNED_VERSION=0.3.0
MANAGESF_PINNED_VERSION=0.7.0
CAUTH_PINNED_VERSION=0.5.0

export LC_ALL=C

SWIFT_BASE_URL="http://os.enocloud.com:8080"
SWIFT_ACCOUNT="70aab03f69b549cead3cb5f463174a51"
# Base roles cloud and install-server
SWIFT_EDEPLOY_URL="${SWIFT_BASE_URL}/v1/AUTH_${SWIFT_ACCOUNT}/edeploy-base"
# Url where SF roles (software-factory and install-server-vm) are published
SWIFT_SF_URL="${SWIFT_BASE_URL}/v1/AUTH_${SWIFT_ACCOUNT}/edeploy-roles"
# Url where latest doc is stored
SWIFT_DOCS_URL="${SWIFT_BASE_URL}/v1/AUTH_${SWIFT_ACCOUNT}/sfdocs"

# Paths
WORKSPACE="${WORKSPACE:-/var/lib/sf}"
BUILD_DIR="$WORKSPACE/roles"

UPSTREAM="${BUILD_DIR}/upstream"
CACHE_PATH="${BUILD_DIR}/cache/sf-centos7"
IMAGE_PATH="${BUILD_DIR}/install/${SF_VER}/softwarefactory"
DEPS="${WORKSPACE}/deps"

PYSFLIB_CLONED_PATH="${PYSFLIB_CLONED_PATH:-${DEPS}/pysflib}"
CAUTH_CLONED_PATH="${CAUTH_CLONED_PATH:-${DEPS}/cauth}"
MANAGESF_CLONED_PATH="${MANAGESF_CLONED_PATH:-${DEPS}/managesf}"

DOCDIR="${PWD}/docs"
GERRITHOOKS="${PWD}/gerrit-hooks"

# Rebuild cache if these files changed
CACHE_DEPS="./image/softwarefactory.install ./image/third_party_tools"

function prepare_buildenv {
    if [ ! -d $WORKSPACE ]; then
        sudo mkdir -m 0770 $WORKSPACE
        sudo chown ${USER}:root $WORKSPACE
    fi

    [ ! -d "$BUILD_DIR" ] && sudo mkdir -p $BUILD_DIR
    [ ! -d "$DEPS" ]      && sudo mkdir -p $DEPS && sudo chown ${USER}:root $DEPS
    [ ! -d "$UPSTREAM" ]  && sudo mkdir -p $UPSTREAM
}
