---
- hosts: localhost
  gather_facts: no
  tasks:

    - name: create private network
      os_network:
          cloud: rcip-dev-sf-pre-upgrade
          state: present
          name: private

    - name: create private subnet
      os_subnet:
          cloud: rcip-dev-sf-pre-upgrade
          state: present
          network_name: private
          name: private
          cidr: 192.168.0.0/24
          dns_nameservers:
             - 8.8.8.8
             - 8.8.8.4

    - name: create router
      os_router:
          cloud: rcip-dev-sf-pre-upgrade
          state: present
          name: router
          network: public
          interfaces:
            - private

    - name: create security group
      os_security_group:
          cloud: rcip-dev-sf-pre-upgrade
          state: present
          name: sf-pre-upgrade
          egress_default_rules: absent
          description: security group for sf-pre-upgrade instances

    - os_security_group_rule:
          cloud: rcip-dev-sf-pre-upgrade
          security_group: sf-pre-upgrade
          protocol: icmp
          remote_ip_prefix: 0.0.0.0/0

#    - name: get deployment image image:
#        cloud: rcip-dev-sf-pre-upgrade
#        name: sf-snapshot
#        state: present
#        disk_format: qcow2
#        container_format: bare
#        filename: sf-snapshot.qcow2
